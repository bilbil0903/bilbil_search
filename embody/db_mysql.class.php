<?php/****/class db_mysql{	var $connid;	var $dbname;	var $querynum = 0;	function connect($dbhost, $dbuser, $dbpw, $dbname = '', $pconnect = 0, $charset = '')	{		$func = $pconnect == 1 ? 'mysql_pconnect' : 'mysql_connect';          mysql_query("SET NAMES utf8");		if(!$this->connid = @$func($dbhost, $dbuser, $dbpw))		{			echo "connect error";			return false;		}		if($dbname && !@mysql_select_db($dbname , $this->connid))		{			//$this->halt('Cannot use database '.$dbname);			return false;		}		$this->dbname = $dbname;		return $this->connid;	}	function select_db($dbname)	{		if(!@mysql_select_db($dbname , $this->connid)) return false;		$this->dbname = $dbname;		return true;    }	function select($sql, $keyfield = '')	{		$array = array();		$result = $this->query($sql);		while($r = $this->fetch_array($result))		{			if($keyfield)			{				$key = $r[$keyfield];				$array[$key] = $r;			}			else			{				$array[] = $r;			}		}		$this->free_result($result);		return $array;	}	function get_primary($table)	{		$result = $this->query("SHOW COLUMNS FROM $table");		while($r = $this->fetch_array($result))		{			if($r['Key'] == 'PRI') break;		}		$this->free_result($result);		return $r['Field'];	}	function get_fields($table)	{		$fields = array();		$result = $this->query("SHOW COLUMNS FROM $table");		while($r = $this->fetch_array($result))		{			$fields[] = $r['Field'];		}		$this->free_result($result);		return $fields;	}	function affected_rows()	{		return mysql_affected_rows($this->connid);	}	function num_rows($query)	{		return mysql_num_rows($query);	}	function num_fields($query)	{		return mysql_num_fields($query);	}	function result($query, $row)	{		return @mysql_result($query, $row);	}	function free_result(&$query)	{		return mysql_free_result($query);	}	function insert_id()	{		return mysql_insert_id($this->connid);	}	function fetch_row($query)	{		return mysql_fetch_row($query);	}	function escape($string)	{		if(!is_array($string)) return str_replace(array('\n', '\r'), array(chr(10), chr(13)), mysql_real_escape_string($string, $this->connid));		foreach($string as $key=>$val) $string[$key] = $this->escape($val);		return $string;	}	function version()	{		return mysql_get_server_info($this->connid);	}	function close()	{		return mysql_close($this->connid);	}	function error()	{		return @mysql_error($this->connid);	}	function errno()	{		return intval(@mysql_errno($this->connid)) ;	}}?>